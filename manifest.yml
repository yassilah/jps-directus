version: 1.5
type: install
name: Directus
logo: https://icons.duckduckgo.com/ip3/directus.io.ico
homepage: https://directus.io/
description: This template will create an instance of the latest version of Directus, a headless CMS and API for custom databases.
ssl: true

settings:
  fields:  
    - caption: Admin E-mail
      type: string
      inputType: email
      default: admin@example.com
      name: ADMIN_EMAIL
      required: true
    - caption: Admin Password
      type: string
      inputType: password
      default: password
      name: ADMIN_PASSWORD
      required: true

nodes:
  - database:
    displayName: Database
    cloudlets: 8
    nodeGroup: sqldb
    nodeType: postgresql
    skipNodeEmails: true
  - load-balancer:
    displayName: Load Balancer
    cloudlets: 1
    nodeGroup: bl
    nodeType: nginx
    skipNodeEmails: true
  - cache:
    displayName: Cache
    cloudlets: 4
    nodeType: redis
    nodeGroup: cache
    skipNodeEmails: true

onInstall:
  - addNodes:
    - admin-panel:
      displayName: Admin Panel
      cloudlets: 8
      nodeGroup: cp
      nodeType: docker
      dockerName: directus/directus
      skipNodeEmails: true
      dockerTag: latest
      dockerRunCmd: node cli.js bootstrap && pm2-runtime start ecosystem.config.cjs ;
      dockerEntryPoint: /bin/sh -c
      extip: true
      dockerEnvVars:
        SECRET: ${fn.uuid}
        ADMIN_EMAIL: ${settings.ADMIN_EMAIL}
        ADMIN_PASSWORD: ${settings.ADMIN_PASSWORD}
        DB_USER: webadmin
        DB_PASSWORD: ${nodes.postgresql.password}
        DB_CLIENT: pg
        DB_HOST: ${nodes.postgresql.address}
        DB_PORT: 5432
        DB_DATABASE: postgres
        CACHE_ENABLED: true
        CACHE_AUTO_PURGE: true
        CACHE_STORE: redis
        REDIS_HOST: ${nodes.cache.address}
        REDIS_PORT: 6379
        REDIS_PASSWORD: ${nodes.cache.password}
        PUBLIC_URL: ${env.url}
